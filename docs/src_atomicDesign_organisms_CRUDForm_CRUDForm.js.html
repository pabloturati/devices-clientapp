<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: src/atomicDesign/organisms/CRUDForm/CRUDForm.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: src/atomicDesign/organisms/CRUDForm/CRUDForm.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import React, { useEffect } from 'react'
import PropTypes from 'prop-types'
import { Redirect } from 'react-router-dom'
import { STATION_TYPES } from 'projectData/constants'
import apiEndpoints from 'projectData/apiEndpoints'
import NotifyModal from 'atomicDesign/organisms/NotifyModal/NotifyModal'
import './CRUDForm.scss'
import {
  useObject,
  useRedirect,
  useToggleView
} from 'sharedFunctions/customHooks'
import { postData, updateData } from 'sharedFunctions/apiRequest'
import routes from 'projectData/routes'
import {
  Form,
  FormGroup,
  Label,
  Input,
  FormFeedback,
  FormText
} from 'reactstrap'
import BaseButton from 'atomicDesign/atoms/BaseButton/BaseButton'

const CRUDForm = ({ initData }) => {
  const initialValues = {
    systemName: initData ? initData.system_name : '',
    systemType: initData ? initData.type : STATION_TYPES[0].type, // Defaults to Windows PC
    hddCapacity: initData ? initData.hdd_capacity : ''
  }

  // Form values state handler. Initialized empty if creating new.
  const { content: formValues, updateVal, mergeObj } = useObject(initialValues)

  const updateValues = () => {
    mergeObj(initialValues)
  }

  useEffect(updateValues, [initData])

  const { systemName, systemType, hddCapacity } = formValues

  // Redirect state handler
  const { toRedirect, activateRedirect } = useRedirect()

  // Error modal handler
  const { viewStatus, toggleViewStatus: toggleModal } = useToggleView()

  const handleSubmit = event => {
    event.preventDefault()
    const body = {
      system_name: systemName,
      type: matchSystemType(systemType),
      hdd_capacity: `${hddCapacity}`
    }

    // Update the device or create a new one
    if (initData) {
      updateData(
        `${apiEndpoints.updateDevice}/${initData.id}`,
        body,
        toggleModal
      )
    } else {
      postData(apiEndpoints.postDevice, body, toggleModal)
    }
  }

  const fields = [
    {
      type: 'text',
      name: 'o__crud-form__input__system_name',
      id: 'o__crud-form__input__system_name',
      placeholder: 'Name',
      value: systemName,
      onChange: event => {
        updateVal('systemName', event.target.value.toUpperCase())
      }
    },
    {
      type: 'select',
      name: 'o__crud-form__input__type',
      id: 'o__crud-form__input__type',
      value: systemType,
      onChange: event => {
        updateVal('systemType', event.target.value)
      }
    },
    {
      type: 'number',
      name: 'o__crud-form__input__hdd-capacity',
      id: 'o__crud-form__input__hdd-capacity',
      placeholder: 'HDD Capacity',
      value: hddCapacity,
      onChange: event => {
        updateVal('hddCapacity', event.target.value)
      }
    }
  ]

  const modalProps = {
    isModalOpen: viewStatus,
    toggleModal: () => activateRedirect(),
    header: 'Success!',
    message: `New ${systemName} with ${systemType} OS and ${hddCapacity} GB capacity was registered.`
  }

  if (toRedirect) return &lt;Redirect to={routes.home} />

  return (
    &lt;div className='o__crud-form'>
      &lt;Form onSubmit={handleSubmit} noValidate>
        &lt;FormGroup>
          &lt;Label for={fields[0].id}>System Name&lt;/Label>
          &lt;Input {...fields[0]} />
          &lt;FormFeedback>
            Invalid name. Provide a valid sysmtem name
          &lt;/FormFeedback>
          &lt;FormText>
            System name can include letters from a-z, numbers (0-9) and
            hyphen(-).
          &lt;/FormText>
        &lt;/FormGroup>
        &lt;FormGroup>
          &lt;Label for={fields[1].id}>Select&lt;/Label>
          &lt;Input {...fields[1]}>
            {STATION_TYPES.map(station => (
              &lt;option key={station.type}>{station.type}&lt;/option>
            ))}
          &lt;/Input>
        &lt;/FormGroup>
        &lt;FormGroup>
          &lt;Label for={fields[2].id}>Disk Capacity&lt;/Label>
          &lt;Input {...fields[2]} />
          &lt;FormFeedback>
            Only numbers in the 1 to 10,000 range are allowed
          &lt;/FormFeedback>
          &lt;FormText>Provide the HDD Capacity of the system in GB&lt;/FormText>
        &lt;/FormGroup>
        &lt;BaseButton
          content={initData ? 'Update Device' : 'Create new device'}
          size='md'
          color='info'
          type='submit'
        />
      &lt;/Form>
      &lt;NotifyModal {...modalProps} />
    &lt;/div>
  )
}

/**
 * Function to parse the system type from frontend (user friendly format)
 * to backend storage format.
 * @format
 * @param {string} systemType
 * @return - sytem type string in backend format.
 */

function matchSystemType (systemType) {
  return STATION_TYPES.filter(station => station.type === systemType)[0]
    .identifier
}

CRUDForm.propTypes = {
  initData: PropTypes.objectOf(
    PropTypes.oneOfType([PropTypes.string, PropTypes.number])
  )
}

export default CRUDForm
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Global</h3><ul><li><a href="global.html#createDeviceList">createDeviceList</a></li><li><a href="global.html#deleteData">deleteData</a></li><li><a href="global.html#filterDevices">filterDevices</a></li><li><a href="global.html#getData">getData</a></li><li><a href="global.html#matchSystemType">matchSystemType</a></li><li><a href="global.html#navigateTo">navigateTo</a></li><li><a href="global.html#parseToFrontData">parseToFrontData</a></li><li><a href="global.html#postConfig">postConfig</a></li><li><a href="global.html#putConfig">putConfig</a></li><li><a href="global.html#sortDevices">sortDevices</a></li><li><a href="global.html#useObject">useObject</a></li><li><a href="global.html#useRedirect">useRedirect</a></li><li><a href="global.html#useToggleView">useToggleView</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 3.6.3</a> on Sun Nov 10 2019 07:42:15 GMT-0500 (EST)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
